@startuml
set separator none
title flarelette-jwt-kit - @chrislyons-dev/flarelette-jwt - Components

top to bottom direction
skinparam ranksep 60
skinparam nodesep 30

skinparam {
  arrowFontSize 10
  defaultTextAlignment center
  wrapWidth 200
  maxMessageSize 100
  defaultFontName "Arial"
}

hide stereotype

skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksallowedThumbprints>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksclearHttpJwksCache>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksclearJwksCache>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksfetchJwksFromService>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksfetchJwksFromUrl>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksgetKeyFromJwks>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksvalidateJwksUrl>> {
  BackgroundColor #85bbf0
  FontColor #000000
  BorderColor #5d82a8
  roundCorner 20
  shadowing false
}
skinparam rectangle<<flarelettejwtkit.chrislyonsdevflarelettejwt>> {
  BorderColor #2e6295
  FontColor #2e6295
  shadowing false
}

rectangle "@chrislyons-dev/flarelette-jwt\n<size:10>[Container: Service]</size>" <<flarelettejwtkit.chrislyonsdevflarelettejwt>> {
  rectangle "==jwks.clearJwksCache\n<size:10>[Component: function]</size>\n\nClear the JWKS cache (for testing purposes)" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksclearJwksCache>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksclearJwksCache
  rectangle "==jwks.clearHttpJwksCache\n<size:10>[Component: function]</size>\n\nClear the HTTP JWKS cache (for testing purposes)" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksclearHttpJwksCache>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksclearHttpJwksCache
  rectangle "==jwks.fetchJwksFromService\n<size:10>[Component: function]</size>\n\nFetch JWKS from a service binding Implements 5-minute caching to reduce load on JWKS service" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksfetchJwksFromService>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksfetchJwksFromService
  rectangle "==jwks.validateJwksUrl\n<size:10>[Component: function]</size>\n\nValidate JWKS URL for security requirements Requirements: - Must be valid URL format - Must use HTTPS (except localhost/127.0.0.1/[::1] for testing)" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksvalidateJwksUrl>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksvalidateJwksUrl
  rectangle "==jwks.fetchJwksFromUrl\n<size:10>[Component: function]</size>\n\nFetch JWKS from HTTP URL with caching Implements configurable TTL caching (default 5 minutes) Security: HTTPS-only (except localhost), 5-second timeout, 100KB size limit" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksfetchJwksFromUrl>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksfetchJwksFromUrl
  rectangle "==jwks.getKeyFromJwks\n<size:10>[Component: function]</size>\n\nFind and import a specific key from JWKS by kid Supports both EdDSA (Ed25519) and RSA (RS256/RS384/RS512) keys Algorithm is auto-detected from key type (kty) and curve (crv)" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksgetKeyFromJwks>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksgetKeyFromJwks
  rectangle "==jwks.allowedThumbprints\n<size:10>[Component: function]</size>\n\nGet allowed thumbprints for key pinning (optional security measure)" <<flarelettejwtkit.chrislyonsdevflarelettejwt.jwksallowedThumbprints>> as flarelettejwtkit.chrislyonsdevflarelettejwt.jwksallowedThumbprints
}

@enduml